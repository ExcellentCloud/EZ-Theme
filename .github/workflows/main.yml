name: Build EZ-Theme 🚀

on:
  workflow_dispatch:   # 👉 手动触发构建

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 🟢 第 1 步：拉取代码
      - name: 📥 Checkout 代码
        uses: actions/checkout@v4   # ✅ 升级到 v4

      # 🟢 第 2 步：设置 Node.js 环境
      - name: 🛠️ 安装 Node.js 环境
        uses: actions/setup-node@v4   # ✅ 升级到 v4
        with:
          node-version: 20            # ✅ 推荐使用 LTS 20，避免依赖过旧

      # 🟢 第 3 步：安装依赖
      - name: 📦 安装项目依赖
        run: |
          echo "🔍 正在安装依赖..."
          npm ci || npm install       # ✅ 优先使用 ci，更稳定
          npm install defu --save     # ✅ 补充缺失依赖
          npm install --legacy-peer-deps   # ✅ 避免 peerDependencies 报错
          echo "✅ 依赖安装完成！"

      # 🟢 第 4 步：构建项目
      - name: 🏗️ 构建项目
        run: |
          echo "⚙️ 开始构建..."
          npm run build
          echo "✅ 构建完成！"

      # 🟢 第 5 步：打包构建产物
      - name: 📦 压缩构建结果
        run: |
          zip -r ez-theme-dist.zip dist
          echo "✅ 已生成压缩包：ez-theme-dist.zip"

      # 🟢 第 6 步：上传构建产物
      - name: ☁️ 上传打包产物
        uses: actions/upload-artifact@v4   # ✅ 最新版本
        with:
          name: ez-theme-dist
          path: |
            dist
            ez-theme-dist.zip
